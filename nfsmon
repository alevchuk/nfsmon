#!/usr/bin/env ruby

if ARGV.size != 1
  STDERR.puts "ERROR: Invalid number of arguments #{ARGV.size}"
  STDERR.puts "Usage: #{File.basename(__FILE__)} <probe-directory>"
  STDERR.puts ""
  STDERR.puts "  <probe-directory>  is where pstmd is running"
  exit 1
end
PROBE_DIR = ARGV[0]

SCREENS = 1


COLS = `tput cols`.to_i
ROWS = (`tput lines`.to_i - 1) * SCREENS


ACTUAL = Hash.new(0)
lineno = 0
`cat #{PROBE_DIR}/log | cut -f1 | uniq -c`.each_line do |line|
  count, timestamp = line.split(' ')
  date, time = timestamp.split('_')
  h,m = time.split('-')

  p [count, date, h,m]
  #ACTUAL["#{h}:#{m}"] = count.to_i
end

exit


t_now = Time.now
EXPECTED =
  ((t_now - (ROWS - 1) * 60)..(t_now)).step(60).to_a.reverse.collect do |t|
    "#{t.hour.to_s.rjust(2, '0')}:#{t.min.to_s.rjust(2, '0')}"
  end

EXPECTED.each_with_index do |t_str, i|
  unfinished = (i == 0 ? '...' : '')
  puts "#{t_str} " + "*" * ACTUAL[t_str] + unfinished +
    " #{ACTUAL[t_str].to_s.rjust(2,'0')}"
end
